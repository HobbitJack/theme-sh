#!/usr/bin/sh

CHAR="#"

if [ -z "$1" ] || [ "$1" = "-h" ] || [ "$1" = "--help" ] || [ "$1" = "-?" ]
then
	echo "Usage: theme-sh [-c|--comment-char CHAR] PROGNAME [RESOURCE]"
	echo "Usage: theme-sh [-h|-v|--help|--version]"
	echo "Install theme for PROGNAME to RESOUCE (default: ~/.Xresources)"
	echo
	echo "  -c, --comment-char=CHAR   use comment char CHAR; no CHAR for no comment"
	echo "  -h, --help                output this help and exit"
	echo "  -v, --version             output version and exit"
	echo
	echo "For full documentation, try 'man theme-sh'"
	exit
fi

if [ "$1" = "-v" ] || [ "$1" = "--version" ] || [ "$1" = "-V" ]
then
	echo "theme-sh v1.0.0"
	echo "Copyright (C) 2025 Jack Renton Uteg"
	echo "Written by Jack R. Uteg"
	exit
fi

if [ "$1" = "-c" ] || [ "$1" = "--comment-char" ]
then
	CHAR="$2"
	shift 2
fi

if [ ! -f "$HOME/.local/etc/theme/${1}" ]
then
	echo "${0}: ${1}: no such theme"
	exit 1
fi

SED=$(echo "$1" | cat - ~/.local/etc/theme/${1} | awk 'BEGIN {ORS=""} NR == 1 {print "/AUTOGENERATED BY theme-sh FOR " $0 "/d;"} NR != 1 {print "/" $1 "/d;"} END {printf "\n"}' | sed 's/\*/\\*/g')

if [ -z "$2" ]
then
	TARGET="$HOME/.Xresources"
else
	TARGET=$(echo "$(dirname $2)/$(basename $2)")
fi

sed -i -e "$SED" "$TARGET" 
if [ -n "$CHAR" ]
then
	echo "${CHAR}${CHAR} AUTOGENERATED BY theme-sh FOR ${1} ${CHAR}${CHAR}" >> "$TARGET"
fi
cat ~/.cache/wal/colors ~/.cache/wal/wal | awk -f ~/.local/share/awk/theme-sh.awk | cat - ~/.local/etc/theme/$1 | m4 >> "$TARGET"
